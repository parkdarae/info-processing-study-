<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - 문제은행 관리</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 10px;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-warning {
            background: #ffc107;
            color: #333;
        }

        .status-danger {
            background: #dc3545;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
        }

        .tab {
            padding: 15px 30px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .question-viewer {
            margin-bottom: 30px;
        }

        .question-item {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .question-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .question-item .text {
            white-space: pre-line;
            margin: 10px 0;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .validation-results {
            margin-top: 20px;
        }

        .validation-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .validation-item.fail {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .validation-item.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #667eea;
            color: white;
        }

        tr:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-cog"></i> Admin - 문제은행 관리</h1>
            <p>추출 품질 확인 및 검수 시스템</p>
            <div id="statusBadge" class="status-badge"></div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>총 페이지</h3>
                <div class="stat-value" id="totalPages">0</div>
            </div>
            <div class="stat-card">
                <h3>총 문항</h3>
                <div class="stat-value" id="totalQuestions">0</div>
            </div>
            <div class="stat-card">
                <h3>총 표</h3>
                <div class="stat-value" id="totalTables">0</div>
            </div>
            <div class="stat-card">
                <h3>실패</h3>
                <div class="stat-value" id="failures">0</div>
            </div>
            <div class="stat-card">
                <h3>경고</h3>
                <div class="stat-value" id="warnings">0</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('report')">
                <i class="fas fa-chart-line"></i> 리포트
            </div>
            <div class="tab" onclick="showTab('questions')">
                <i class="fas fa-question-circle"></i> 문항 검수
            </div>
            <div class="tab" onclick="showTab('tables')">
                <i class="fas fa-table"></i> 표 검수
            </div>
            <div class="tab" onclick="showTab('validation')">
                <i class="fas fa-check-circle"></i> 검증 결과
            </div>
        </div>

        <div class="tab-content active" id="reportTab">
            <h2>추출 리포트</h2>
            <div id="reportContent"></div>
        </div>

        <div class="tab-content" id="questionsTab">
            <h2>문항 검수</h2>
            <div id="questionsContent"></div>
        </div>

        <div class="tab-content" id="tablesTab">
            <h2>표 검수</h2>
            <div id="tablesContent"></div>
        </div>

        <div class="tab-content" id="validationTab">
            <h2>검증 결과</h2>
            <div id="validationContent"></div>
        </div>
    </div>

    <script>
        let report = {};
        let questions = [];
        let tables = [];

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // 데이터 로드
        async function loadData() {
            try {
                // report.json 로드
                const reportResponse = await fetch('report.json');
                report = await reportResponse.json();
                
                // items.jsonl 로드
                const itemsResponse = await fetch('items.jsonl');
                const itemsText = await itemsResponse.text();
                questions = itemsText.trim().split('\n').map(line => JSON.parse(line));
                
                // tables.jsonl 로드
                const tablesResponse = await fetch('tables.jsonl');
                const tablesText = await tablesResponse.text();
                tables = tablesText.trim().split('\n').map(line => JSON.parse(line));
                
                displayReport();
                
            } catch (error) {
                console.error('데이터 로드 오류:', error);
            }
        }

        // 리포트 표시
        function displayReport() {
            // 통계 업데이트
            document.getElementById('totalPages').textContent = report.total_pages || 0;
            document.getElementById('totalQuestions').textContent = report.total_questions || 0;
            document.getElementById('totalTables').textContent = report.total_tables || 0;
            document.getElementById('failures').textContent = report.failures || 0;
            document.getElementById('warnings').textContent = report.warnings || 0;
            
            // 상태 배지
            const statusBadge = document.getElementById('statusBadge');
            if (report.failures === 0 && report.warnings === 0) {
                statusBadge.className = 'status-badge status-success';
                statusBadge.textContent = '✓ 100% 정확도 달성';
            } else if (report.failures > 0) {
                statusBadge.className = 'status-badge status-danger';
                statusBadge.textContent = '✗ 검증 실패';
            } else {
                statusBadge.className = 'status-badge status-warning';
                statusBadge.textContent = '⚠ 경고 발생';
            }
            
            // 리포트 내용
            const reportContent = document.getElementById('reportContent');
            reportContent.innerHTML = `
                <div class="validation-results">
                    <h3>버전 정보</h3>
                    <p><strong>버전:</strong> ${report.version}</p>
                    <p><strong>문서 ID:</strong> ${report.doc_id}</p>
                    
                    <h3 style="margin-top: 20px;">검증 결과</h3>
                    <div class="validation-item ${report.failures > 0 ? 'fail' : 'success'}">
                        <strong>실패:</strong> ${report.failures}건
                    </div>
                    <div class="validation-item ${report.warnings > 0 ? 'warning' : 'success'}">
                        <strong>경고:</strong> ${report.warnings}건
                    </div>
                </div>
            `;
            
            // 검증 결과 표시
            if (report.validation_results) {
                displayValidationResults(report.validation_results);
            }
        }

        // 검증 결과 표시
        function displayValidationResults(results) {
            const validationContent = document.getElementById('validationContent');
            let html = '<h3>상세 검증 결과</h3>';
            
            for (let [key, value] of Object.entries(results)) {
                html += `<h4>${key}</h4>`;
                if (Array.isArray(value) && value.length > 0) {
                    html += '<table><tr><th>항목</th><th>상태</th></tr>';
                    for (let item of value) {
                        html += `<tr><td>${JSON.stringify(item)}</td><td>${item.status || 'OK'}</td></tr>`;
                    }
                    html += '</table>';
                } else {
                    html += '<p>검증 통과</p>';
                }
            }
            
            validationContent.innerHTML = html;
        }

        // 탭 전환
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // 콘텐츠 로드
            if (tabName === 'questions') {
                displayQuestions();
            } else if (tabName === 'tables') {
                displayTables();
            }
        }

        // 문항 표시
        function displayQuestions() {
            const content = document.getElementById('questionsContent');
            let html = '';
            
            for (let q of questions) {
                html += `
                    <div class="question-item">
                        <h4>${q.q_no} (페이지: ${q.page_range.join('-')})</h4>
                        <div class="text"><strong>문제:</strong> ${escapeHtml(q.question_text)}</div>
                        ${q.choices.length > 0 ? `
                            <div class="text"><strong>선택지:</strong>
                                ${q.choices.map((c, i) => `${c.raw_key}: ${escapeHtml(c.text)}`).join('<br>')}
                            </div>
                        ` : ''}
                        <div class="text"><strong>정답:</strong> ${q.answer.raw_text}</div>
                        ${q.explanation ? `<div class="text"><strong>해설:</strong> ${escapeHtml(q.explanation)}</div>` : ''}
                        ${q.image_refs.length > 0 ? `
                            <div class="text"><strong>이미지:</strong> ${q.image_refs.join(', ')}</div>
                        ` : ''}
                    </div>
                `;
            }
            
            content.innerHTML = html;
        }

        // 표 표시
        function displayTables() {
            const content = document.getElementById('tablesContent');
            let html = '';
            
            for (let t of tables) {
                html += `
                    <div class="question-item">
                        <h4>${t.table_id} (페이지: ${t.page})</h4>
                        <div class="text"><strong>캡션:</strong> ${escapeHtml(t.caption)}</div>
                        <table>
                            <tr>${t.header.map(h => `<th>${escapeHtml(h)}</th>`).join('')}</tr>
                            ${t.rows.map(row => `<tr>${row.map(cell => `<td>${escapeHtml(cell)}</td>`).join('')}</tr>`).join('')}
                        </table>
                    </div>
                `;
            }
            
            content.innerHTML = html;
        }

        // HTML 이스케이프
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

