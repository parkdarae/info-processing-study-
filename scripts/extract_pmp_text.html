<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMP PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ ë„êµ¬</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #6f42c1;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .instruction {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .instruction h3 {
            color: #1976d2;
            margin-top: 0;
        }
        
        .instruction ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instruction li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        textarea {
            width: 100%;
            height: 400px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
        }
        
        .buttons {
            margin-top: 20px;
            text-align: center;
        }
        
        .btn {
            background: #6f42c1;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #5a32a3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .output {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .output h3 {
            color: #28a745;
            margin-top: 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #6f42c1;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .download-section {
            margin-top: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ PMP PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ ë„êµ¬</h1>
        
        <div class="instruction">
            <h3>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h3>
            <ol>
                <li><strong>PMP-2025.07.30.pdf</strong> íŒŒì¼ì„ PDF ë·°ì–´ë¡œ ì—´ê¸°</li>
                <li><strong>Ctrl + A</strong>ë¡œ ì „ì²´ ì„ íƒ í›„ <strong>Ctrl + C</strong>ë¡œ ë³µì‚¬</li>
                <li>ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— <strong>Ctrl + V</strong>ë¡œ ë¶™ì—¬ë„£ê¸°</li>
                <li><strong>"ë¬¸ì œ ì¶”ì¶œí•˜ê¸°"</strong> ë²„íŠ¼ í´ë¦­</li>
                <li>ì¶”ì¶œ ê²°ê³¼ í™•ì¸ í›„ <strong>"JSONL ë‹¤ìš´ë¡œë“œ"</strong> í´ë¦­</li>
            </ol>
            <p><strong>âš ï¸ ì£¼ì˜:</strong> ì´ë¯¸ì§€ë‚˜ ë„í‘œê°€ í¬í•¨ëœ ë¬¸ì œëŠ” ìë™ìœ¼ë¡œ ì œì™¸ë©ë‹ˆë‹¤.</p>
        </div>
        
        <textarea id="pdfText" placeholder="PMP PDFì˜ ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        
        <div class="buttons">
            <button class="btn" onclick="extractQuestions()">
                <i class="fas fa-cogs"></i> ë¬¸ì œ ì¶”ì¶œí•˜ê¸°
            </button>
            <button class="btn btn-secondary" onclick="clearText()">
                <i class="fas fa-trash"></i> í…ìŠ¤íŠ¸ ì§€ìš°ê¸°
            </button>
        </div>
        
        <div class="output" id="outputSection" style="display: none;">
            <h3>ğŸ“Š ì¶”ì¶œ ê²°ê³¼</h3>
            <div class="stats" id="statsContainer">
                <!-- í†µê³„ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <div class="download-section">
                <button class="btn" onclick="downloadJSONL()" id="downloadBtn" disabled>
                    <i class="fas fa-download"></i> JSONL íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                </button>
                <button class="btn btn-secondary" onclick="previewQuestions()">
                    <i class="fas fa-eye"></i> ë¬¸ì œ ë¯¸ë¦¬ë³´ê¸°
                </button>
            </div>
            
            <div id="previewSection" style="display: none; margin-top: 20px;">
                <h4>ğŸ” ì¶”ì¶œëœ ë¬¸ì œ ë¯¸ë¦¬ë³´ê¸°</h4>
                <div id="questionPreview" style="max-height: 300px; overflow-y: auto; background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;"></div>
            </div>
        </div>
    </div>

    <script>
        let extractedQuestions = [];

        // PMP ë¼ë²¨ í‚¤ì›Œë“œ ë§¤í•‘
        const PMP_KNOWLEDGE_AREAS = {
            'project_integration': {
                keywords: ['í†µí•©', 'integration', 'í”„ë¡œì íŠ¸ í—Œì¥', 'project charter', 'ë³€ê²½í†µì œ', 'change control', 'ë³€ê²½ ê´€ë¦¬', 'í†µí•© ê´€ë¦¬'],
                name: 'í†µí•©ê´€ë¦¬'
            },
            'project_scope': {
                keywords: ['ë²”ìœ„', 'scope', 'WBS', 'ìš”êµ¬ì‚¬í•­', 'requirements', 'ë²”ìœ„ì •ì˜', 'work breakdown structure'],
                name: 'ë²”ìœ„ê´€ë¦¬'
            },
            'project_schedule': {
                keywords: ['ì¼ì •', 'schedule', 'CPM', 'PERT', 'í¬ë¦¬í‹°ì»¬íŒ¨ìŠ¤', 'critical path', 'íƒ€ì„ë¼ì¸', 'timeline', 'í™œë™', 'activity'],
                name: 'ì¼ì •ê´€ë¦¬'
            },
            'project_cost': {
                keywords: ['ì›ê°€', 'cost', 'ì˜ˆì‚°', 'budget', 'EVM', 'íšë“ê°€ì¹˜', 'earned value', 'CPI', 'SPI', 'AC', 'PV', 'EV'],
                name: 'ì›ê°€ê´€ë¦¬'
            },
            'project_quality': {
                keywords: ['í’ˆì§ˆ', 'quality', 'QA', 'QC', 'í’ˆì§ˆë³´ì¦', 'í’ˆì§ˆí†µì œ', 'quality assurance', 'quality control'],
                name: 'í’ˆì§ˆê´€ë¦¬'
            },
            'project_resource': {
                keywords: ['ìì›', 'resource', 'íŒ€', 'team', 'ì¸ì ìì›', 'human resource', 'RACI', 'ì—­í• ', 'role'],
                name: 'ìì›ê´€ë¦¬'
            },
            'project_communication': {
                keywords: ['ì˜ì‚¬ì†Œí†µ', 'communication', 'ì»¤ë®¤ë‹ˆì¼€ì´ì…˜', 'ë³´ê³ ', 'reporting', 'ì •ë³´ë°°í¬', 'íšŒì˜', 'meeting'],
                name: 'ì˜ì‚¬ì†Œí†µê´€ë¦¬'
            },
            'project_risk': {
                keywords: ['ìœ„í—˜', 'risk', 'ë¦¬ìŠ¤í¬', 'ìœ„í—˜ê´€ë¦¬', 'ëª¬í…Œì¹´ë¥¼ë¡œ', 'monte carlo', 'ìœ„í—˜ ë¶„ì„', 'ìœ„í—˜ ëŒ€ì‘'],
                name: 'ìœ„í—˜ê´€ë¦¬'
            },
            'project_procurement': {
                keywords: ['ì¡°ë‹¬', 'procurement', 'ê³„ì•½', 'contract', 'RFP', 'êµ¬ë§¤', 'purchasing', 'ê³µê¸‰ì—…ì²´', 'vendor'],
                name: 'ì¡°ë‹¬ê´€ë¦¬'
            },
            'project_stakeholder': {
                keywords: ['ì´í•´ê´€ê³„ì', 'stakeholder', 'ê³ ê°', 'customer', 'ìŠ¤í°ì„œ', 'sponsor', 'ì´í•´ë‹¹ì‚¬ì'],
                name: 'ì´í•´ê´€ê³„ìê´€ë¦¬'
            }
        };

        const PMP_PROCESS_GROUPS = {
            'initiating': {
                keywords: ['ì°©ìˆ˜', 'ì‹œì‘', 'initiate', 'í”„ë¡œì íŠ¸í—Œì¥', 'ì´í•´ê´€ê³„ìì‹ë³„'],
                name: 'ì°©ìˆ˜'
            },
            'planning': {
                keywords: ['ê¸°íš', 'ê³„íš', 'planning', 'ê³„íšì„œ', 'ì •ì˜', 'ìˆ˜ë¦½'],
                name: 'ê¸°íš'
            },
            'executing': {
                keywords: ['ì‹¤í–‰', 'executing', 'ìˆ˜í–‰', 'ì‹¤ì‹œ', 'ê°œë°œ', 'ê´€ë¦¬'],
                name: 'ì‹¤í–‰'
            },
            'monitoring': {
                keywords: ['ê°ì‹œ', 'í†µì œ', 'monitoring', 'controlling', 'ì¸¡ì •', 'ì¶”ì '],
                name: 'ê°ì‹œí†µì œ'
            },
            'closing': {
                keywords: ['ì¢…ë£Œ', 'closing', 'ì™„ë£Œ', 'ì¸ìˆ˜', 'êµí›ˆí•™ìŠµ', 'lessons learned'],
                name: 'ì¢…ë£Œ'
            }
        };

        // ì´ë¯¸ì§€ ê°ì§€ í‚¤ì›Œë“œ
        const imageIndicators = [
            'figure', 'diagram', 'chart', 'graph', 'table', 'image', 'picture',
            'network diagram', 'gantt chart', 'flowchart', 'organizational chart',
            'ê·¸ë¦¼', 'ë„í‘œ', 'ì°¨íŠ¸', 'í‘œ', 'ë‹¤ì´ì–´ê·¸ë¨', 'ì´ë¯¸ì§€', 'ì‚¬ì§„',
            'see figure', 'refer to diagram', 'ì•„ë˜ ê·¸ë¦¼', 'ë‹¤ìŒ ë„í‘œ'
        ];

        function extractQuestions() {
            const text = document.getElementById('pdfText').value.trim();
            
            if (!text) {
                alert('PDF í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ ì‹œì‘...');
            
            // ë¬¸ì œ ë¶„ë¦¬ (ì—¬ëŸ¬ íŒ¨í„´ ì‹œë„)
            const questionPatterns = [
                /(\d+)\.\s+([^]*?)(?=\d+\.\s+|$)/g,  // 1. 2. 3. íŒ¨í„´
                /(Question\s+\d+[^]*?)(?=Question\s+\d+|$)/gi,  // Question 1, 2, 3 íŒ¨í„´
                /(\d+)\)\s+([^]*?)(?=\d+\)\s+|$)/g   // 1) 2) 3) íŒ¨í„´
            ];

            let questions = [];
            
            for (let pattern of questionPatterns) {
                const matches = [...text.matchAll(pattern)];
                if (matches.length > 0) {
                    console.log(`íŒ¨í„´ ë§¤ì¹˜ ë°œê²¬: ${matches.length}ê°œ`);
                    
                    for (let match of matches) {
                        const questionData = parseQuestion(match);
                        if (questionData) {
                            questions.push(questionData);
                        }
                    }
                    break; // ì²« ë²ˆì§¸ ì„±ê³µí•œ íŒ¨í„´ ì‚¬ìš©
                }
            }

            if (questions.length === 0) {
                alert('ë¬¸ì œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. PDF í…ìŠ¤íŠ¸ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            extractedQuestions = questions;
            displayResults(questions);
        }

        function parseQuestion(match) {
            try {
                const fullText = match[0];
                let questionNumber = match[1];
                
                // ì´ë¯¸ì§€ í¬í•¨ ë¬¸ì œ ê°ì§€
                if (hasImages(fullText)) {
                    console.log(`ë¬¸ì œ ${questionNumber}: ì´ë¯¸ì§€ ê°ì§€, ì œì™¸`);
                    return null;
                }

                // ì„ íƒì§€ ì¶”ì¶œ
                const choicePatterns = [
                    /([A-D])\)\s*([^\n\r]+)/g,  // A) B) C) D)
                    /([1-4])\)\s*([^\n\r]+)/g,  // 1) 2) 3) 4)
                    /([â‘ â‘¡â‘¢â‘£])\s*([^\n\r]+)/g   // â‘  â‘¡ â‘¢ â‘£
                ];

                let choices = [];
                for (let pattern of choicePatterns) {
                    choices = [...fullText.matchAll(pattern)];
                    if (choices.length >= 4) break;
                }

                if (choices.length < 4) {
                    console.log(`ë¬¸ì œ ${questionNumber}: ì„ íƒì§€ ë¶€ì¡± (${choices.length}ê°œ)`);
                    return null;
                }

                // ì •ë‹µ ì¶”ì¶œ
                const answerPatterns = [
                    /Answer:\s*([A-D])/i,
                    /ì •ë‹µ:\s*([A-Dâ‘ â‘¡â‘¢â‘£])/i,
                    /Correct\s*Answer:\s*([A-D])/i
                ];

                let answer = null;
                for (let pattern of answerPatterns) {
                    const answerMatch = fullText.match(pattern);
                    if (answerMatch) {
                        answer = answerMatch[1].toUpperCase();
                        // â‘ â‘¡â‘¢â‘£ë¥¼ A,B,C,Dë¡œ ë³€í™˜
                        if (answer === 'â‘ ') answer = 'A';
                        else if (answer === 'â‘¡') answer = 'B';
                        else if (answer === 'â‘¢') answer = 'C';
                        else if (answer === 'â‘£') answer = 'D';
                        break;
                    }
                }

                if (!answer) {
                    console.log(`ë¬¸ì œ ${questionNumber}: ì •ë‹µ ì—†ìŒ`);
                    return null;
                }

                // í•´ì„¤ ì¶”ì¶œ
                const explanationPatterns = [
                    /(?:Explanation|í•´ì„¤|í’€ì´):\s*([^]*?)(?=\d+\.|Question\s+\d+|$)/i
                ];

                let explanation = '';
                for (let pattern of explanationPatterns) {
                    const expMatch = fullText.match(pattern);
                    if (expMatch) {
                        explanation = expMatch[1].trim();
                        break;
                    }
                }

                // ë¬¸ì œ ë³¸ë¬¸ ì¶”ì¶œ (ì„ íƒì§€ ì´ì „ê¹Œì§€)
                let questionText = fullText;
                const firstChoiceIndex = fullText.search(/[A-D1-4â‘ â‘¡â‘¢â‘£]\)/);
                if (firstChoiceIndex !== -1) {
                    questionText = fullText.substring(0, firstChoiceIndex).trim();
                }
                
                // ë¬¸ì œ ë²ˆí˜¸ ì œê±°
                questionText = questionText.replace(/^\d+\.\s*|^Question\s+\d+\s*/i, '').trim();

                // ë¼ë²¨ë§
                const labels = classifyPMPQuestion(questionText + ' ' + explanation);

                return {
                    id: `PMP${String(questionNumber).padStart(3, '0')}`,
                    q_no: questionNumber,
                    question: questionText,
                    options: choices.map(choice => `${choice[1]}) ${choice[2]}`),
                    answer: answer,
                    answer_text: getAnswerText(choices, answer),
                    explanation: explanation || 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.',
                    labels: labels,
                    difficulty: 'medium',
                    source: 'PMP-2025.07.30.pdf',
                    type: 'multiple_choice'
                };

            } catch (error) {
                console.error(`ë¬¸ì œ ${questionNumber} íŒŒì‹± ì˜¤ë¥˜:`, error);
                return null;
            }
        }

        function hasImages(text) {
            const textLower = text.toLowerCase();
            return imageIndicators.some(indicator => textLower.includes(indicator.toLowerCase()));
        }

        function getAnswerText(choices, answer) {
            for (let choice of choices) {
                if (choice[1].toUpperCase() === answer) {
                    return choice[2];
                }
            }
            return '';
        }

        function classifyPMPQuestion(text) {
            const labels = [];
            const textLower = text.toLowerCase();

            // ì§€ì‹ ì˜ì—­ ë¶„ë¥˜
            for (let [key, area] of Object.entries(PMP_KNOWLEDGE_AREAS)) {
                for (let keyword of area.keywords) {
                    if (textLower.includes(keyword.toLowerCase())) {
                        if (!labels.includes(key)) {
                            labels.push(key);
                        }
                        break;
                    }
                }
            }

            // í”„ë¡œì„¸ìŠ¤ ê·¸ë£¹ ë¶„ë¥˜
            for (let [key, group] of Object.entries(PMP_PROCESS_GROUPS)) {
                for (let keyword of group.keywords) {
                    if (textLower.includes(keyword.toLowerCase())) {
                        if (!labels.includes(key)) {
                            labels.push(key);
                        }
                        break;
                    }
                }
            }

            // ê¸°ë³¸ê°’
            if (labels.length === 0) {
                labels.push('project_integration');
            }

            return labels;
        }

        function displayResults(questions) {
            const outputSection = document.getElementById('outputSection');
            const statsContainer = document.getElementById('statsContainer');
            const downloadBtn = document.getElementById('downloadBtn');

            // í†µê³„ ê³„ì‚°
            const stats = calculateStats(questions);

            statsContainer.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">ì´ ë¬¸ì œ ìˆ˜</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.textOnly}</div>
                    <div class="stat-label">í…ìŠ¤íŠ¸ ë¬¸ì œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.withAnswer}</div>
                    <div class="stat-label">ì •ë‹µ ìˆìŒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${stats.withExplanation}</div>
                    <div class="stat-label">í•´ì„¤ ìˆìŒ</div>
                </div>
            `;

            outputSection.style.display = 'block';
            downloadBtn.disabled = false;

            console.log('ì¶”ì¶œ ì™„ë£Œ:', questions.length, 'ê°œ ë¬¸ì œ');
        }

        function calculateStats(questions) {
            return {
                total: questions.length,
                textOnly: questions.length, // ì´ë¯¸ì§€ ë¬¸ì œëŠ” ì´ë¯¸ ì œì™¸ë¨
                withAnswer: questions.filter(q => q.answer).length,
                withExplanation: questions.filter(q => q.explanation && q.explanation !== 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.').length
            };
        }

        function previewQuestions() {
            const previewSection = document.getElementById('previewSection');
            const questionPreview = document.getElementById('questionPreview');

            if (extractedQuestions.length === 0) {
                alert('ë¨¼ì € ë¬¸ì œë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”.');
                return;
            }

            const preview = extractedQuestions.slice(0, 3).map(q => `
                <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
                    <h5>ë¬¸ì œ ${q.q_no}: ${q.question}</h5>
                    <div>${q.options.join('<br>')}</div>
                    <p><strong>ì •ë‹µ:</strong> ${q.answer} - ${q.answer_text}</p>
                    <p><strong>ë¼ë²¨:</strong> ${q.labels.join(', ')}</p>
                    ${q.explanation !== 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.' ? `<p><strong>í•´ì„¤:</strong> ${q.explanation}</p>` : ''}
                </div>
            `).join('');

            questionPreview.innerHTML = preview + `<p style="text-align: center; color: #666; margin-top: 15px;">... ì´ ${extractedQuestions.length}ê°œ ë¬¸ì œ ì¤‘ 3ê°œ ë¯¸ë¦¬ë³´ê¸°</p>`;
            previewSection.style.display = 'block';
        }

        function downloadJSONL() {
            if (extractedQuestions.length === 0) {
                alert('ì¶”ì¶œëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const jsonlContent = extractedQuestions.map(q => JSON.stringify(q)).join('\n');
            
            const blob = new Blob([jsonlContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'items_pmp_extracted.jsonl';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(`${extractedQuestions.length}ê°œ ë¬¸ì œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        function clearText() {
            document.getElementById('pdfText').value = '';
            document.getElementById('outputSection').style.display = 'none';
            extractedQuestions = [];
        }
    </script>
</body>
</html>
