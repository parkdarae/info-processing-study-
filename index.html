<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸° í•µì‹¬ í‚¤ì›Œë“œ130 ë¬¸ì œì€í–‰</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .mode-selector {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .mode-btn {
            padding: 20px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
        }

        .mode-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .question-container {
            padding: 30px;
            max-height: 600px;
            overflow-y: auto;
        }

        .question-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .question-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .question-no {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .question-text {
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 25px;
            white-space: pre-line;
        }

        .choices {
            margin: 20px 0;
        }

        .choice-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .choice-key {
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
            min-width: 30px;
        }

        .choice-text {
            flex: 1;
            white-space: pre-line;
        }

        .answer-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1.1em;
            margin: 20px 0;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .result-section {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .result-correct {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }

        .result-incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }

        .stats {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .stats h3 {
            margin-bottom: 10px;
            color: #667eea;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }

        .image-placeholder {
            width: 100%;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
            color: #6c757d;
        }

        .image-preview {
            max-width: 100%;
            border-radius: 10px;
            margin: 20px 0;
        }

        .multiple-answers {
            margin: 20px 0;
        }

        .answer-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .answer-item label {
            min-width: 30px;
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .answer-input-small {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
        }

        .symbol-buttons {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .symbol-buttons strong {
            display: block;
            margin-bottom: 10px;
            color: #667eea;
        }

        .symbol-btn {
            padding: 8px 15px;
            margin: 5px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 6px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .symbol-btn:hover {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .table-container {
            margin: 20px 0;
            overflow-x: auto;
        }

        .table-caption {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
            padding: 8px 0;
            border-bottom: 2px solid #667eea;
        }

        .table-after-text {
            margin-top: 15px;
            margin-bottom: 20px;
            padding: 12px;
            background: #f8f9fa;
            border-left: 3px solid #667eea;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .question-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .question-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .question-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .question-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .question-table tbody tr:hover {
            background: #f8f9fa;
        }

        .question-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* ì„¤ëª… ì°½ */
        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 5px;
            white-space: pre-line;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #5568d3;
        }

        .welcome-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .welcome-popup.show {
            display: flex;
        }

        .popup-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .popup-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .popup-content ul {
            list-style: none;
            padding: 0;
        }

        .popup-content li {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
        }

        /* ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ */
        .range-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .range-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
        }

        .range-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .range-modal-header h3 {
            margin: 0;
            font-size: 1.3em;
            color: #333;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: #333;
        }

        .range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .range-input-group {
            display: flex;
            flex-direction: column;
        }

        .range-input-group label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .range-input-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            transition: border-color 0.3s;
        }

        .range-input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .range-preview {
            background: #f5f7fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.95em;
            color: #666;
        }

        .range-order-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .range-order-options label {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .range-order-options input[type="radio"] {
            margin-right: 8px;
        }

        .range-order-options label:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .range-order-options input[type="radio"]:checked + span {
            color: #667eea;
            font-weight: 600;
        }

        .range-modal-buttons {
            display: flex;
            gap: 10px;
        }

        .range-modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .range-modal-buttons .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .range-modal-buttons .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .range-modal-buttons .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .range-modal-buttons .btn-secondary:hover {
            background: #d0d0d0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }

            .mode-buttons {
                grid-template-columns: 1fr;
            }

            .stats {
                position: relative;
                bottom: 0;
                right: 0;
                margin: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- í™˜ì˜ íŒì—… -->
    <div class="welcome-popup" id="welcomePopup">
        <div class="popup-content">
            <h2>í•™ìŠµ ì‹œìŠ¤í…œ ì‚¬ìš© ì•ˆë‚´</h2>
            <p style="margin-bottom: 20px;">ì§€ì›ë˜ëŠ” ì •ë‹µ í˜•ì‹:</p>
            <ul>
                <li>ìˆ«ì: 1, 2, 3, 4</li>
                <li>ì˜ë¬¸: a, b, c, d</li>
                <li>í•œê¸€: ã„±, ã„´, ã„·, ã„¹</li>
                <li>ë²ˆí˜¸: â‘ , â‘¡, â‘¢, â‘£</li>
                <li>ëŒ€ì†Œë¬¸ì ë¬´ì‹œ: Agile = agile = AGILE</li>
                <li>ë„ì–´ì“°ê¸° ë¬´ì‹œ: ì• ìì¼ = ì•  ì ì¼</li>
                <li>ë™ì˜ì–´ ì¸ì‹: ì• ìì¼ = Agile</li>
                <li>ë³µìˆ˜ ì •ë‹µ: 1, 2 ë˜ëŠ” â‘ â‘¡</li>
            </ul>
            <button class="btn btn-primary" onclick="closeWelcomePopup()" style="width: 100%; margin-top: 20px;">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-book-reader"></i> ì •ë³´ì²˜ë¦¬ê¸°ì‚¬ ì‹¤ê¸° í•µì‹¬ í‚¤ì›Œë“œ130 ë¬¸ì œì€í–‰</h1>
            <p>ì‹¤ì‹œê°„ í•™ìŠµ í˜„í™© ë° ì§„ë„ ê´€ë¦¬</p>
        </div>

        <div class="mode-selector">
            <div class="mode-buttons">
                <button class="mode-btn" onclick="setMode('sequential')">
                    <i class="fas fa-forward"></i> ìˆœì°¨ í’€ê¸°
                </button>
                <button class="mode-btn" onclick="setMode('random')">
                    <i class="fas fa-random"></i> ëœë¤ í’€ê¸°
                </button>
                <button class="mode-btn" onclick="setMode('range')">
                    <i class="fas fa-list"></i> ë²”ìœ„ ì„¤ì •
                </button>
                <button class="mode-btn" onclick="setMode('wrong')">
                    <i class="fas fa-times-circle"></i> ì˜¤ë‹µë§Œ í’€ê¸°
                </button>
                <button class="mode-btn" onclick="setMode('marked')">
                    <i class="fas fa-star"></i> ì²´í¬í•œ ë¬¸ì œ
                </button>
            </div>
        </div>

        <div class="question-container" id="questionContainer">
            <div class="question-card">
                <div style="text-align: center; padding: 50px;">
                    <i class="fas fa-book" style="font-size: 4em; color: #667eea; margin-bottom: 20px;"></i>
                    <h2>í•™ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                    <p style="color: #6c757d; margin-top: 10px;">ìœ„ ë²„íŠ¼ ì¤‘ í•˜ë‚˜ë¥¼ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ -->
    <div class="range-modal" id="rangeModal">
        <div class="range-modal-content">
            <div class="range-modal-header">
                <h3><i class="fas fa-list"></i> ë²”ìœ„ ì„¤ì •</h3>
                <button class="close-modal" onclick="closeRangeModal()">Ã—</button>
            </div>
            
            <div class="range-inputs">
                <div class="range-input-group">
                    <label>ì‹œì‘ ë¬¸ì œë²ˆí˜¸</label>
                    <input type="number" id="rangeStart" min="1" max="130" value="1">
                </div>
                <div class="range-input-group">
                    <label>ë ë¬¸ì œë²ˆí˜¸</label>
                    <input type="number" id="rangeEnd" min="1" max="130" value="130">
                </div>
            </div>
            
            <div class="range-preview" id="rangePreview">
                ì„ íƒëœ ë²”ìœ„: 1ë²ˆ ~ 130ë²ˆ (ì´ 130ë¬¸ì œ)
            </div>
            
            <div class="range-order-options">
                <label>
                    <input type="radio" name="rangeOrder" value="sequential" checked>
                    <span>ìˆœì°¨ í’€ê¸°</span>
                </label>
                <label>
                    <input type="radio" name="rangeOrder" value="random">
                    <span>ëœë¤ í’€ê¸°</span>
                </label>
            </div>
            
            <div class="range-modal-buttons">
                <button class="btn-secondary" onclick="closeRangeModal()">ì·¨ì†Œ</button>
                <button class="btn-primary" onclick="applyRangeFilter()">ì‹œì‘í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div class="stats">
        <h3>í•™ìŠµ í†µê³„</h3>
        <div class="stats-item">
            <span>ì§„í–‰ë¥ :</span>
            <span id="progress">0%</span>
        </div>
        <div class="stats-item">
            <span>ì •ë‹µë¥ :</span>
            <span id="accuracy">0%</span>
        </div>
        <div class="stats-item">
            <span>ë‚¨ì€ ë¬¸ì œ:</span>
            <span id="remaining">0</span>
        </div>
        <div class="stats-item">
            <span>ì˜¤ë‹µ ìˆ˜:</span>
            <span id="wrongCount">0</span>
        </div>
        <button class="btn btn-secondary" onclick="resetProgress()" style="width: 100%; margin-top: 10px;">ì´ˆê¸°í™”</button>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allQuestions = [];
        let allTables = {};
        let currentQuestions = [];
        let currentIndex = 0;
        let currentMode = null;
        let stats = {
            total: 0,
            correct: 0,
            wrong: 0,
            wrongQuestions: []
        };

        // ë™ì˜ì–´ ì‚¬ì „
        const synonyms = {
            'ì• ìì¼': ['agile', 'Agile', 'AGILE'],
            'í´ë˜ìŠ¤': ['class', 'Class', 'CLASS'],
            'í•¨ìˆ˜': ['function', 'Function', 'FUNCTION'],
            'ë³€ìˆ˜': ['variable', 'Variable', 'VARIABLE']
        };

        // ì •ê·œí™” í•¨ìˆ˜
        function normalizeAnswer(answer) {
            // ëŒ€ì†Œë¬¸ì ë¬´ì‹œ
            answer = answer.toLowerCase().trim();
            
            // ë„ì–´ì“°ê¸° ì œê±°
            answer = answer.replace(/\s/g, '');
            
            // ë™ì˜ì–´ ë³€í™˜
            for (let [key, values] of Object.entries(synonyms)) {
                if (values.includes(answer)) {
                    answer = key;
                    break;
                }
            }
            
            return answer;
        }

        // í‚¤ ë§¤í•‘
        function mapAnswerKey(input, choices) {
            // ìˆ«ì ë³€í™˜
            const numMap = {'1': '1', '2': '2', '3': '3', '4': '4', 
                           'â‘ ': '1', 'â‘¡': '2', 'â‘¢': '3', 'â‘£': '4',
                           'ã„±': '1', 'ã„´': '2', 'ã„·': '3', 'ã„¹': '4',
                           'a': '1', 'b': '2', 'c': '3', 'd': '4'};
            
            const lowerInput = input.toLowerCase().trim();
            if (numMap[lowerInput]) {
                return numMap[lowerInput];
            }
            
            // ë³µìˆ˜ ì •ë‹µ ì²˜ë¦¬
            const matches = input.match(/[1-4â‘ â‘¡â‘¢â‘£ã„±ã„´ã„·ã„¹abcd]/g);
            if (matches && matches.length > 1) {
                return matches.map(m => numMap[m.toLowerCase()]).filter(Boolean);
            }
            
            return lowerInput;
        }

        // ì •ë‹µ ì²´í¬ (ë‹¨ì¼ ë‹µì•ˆ)
        function checkAnswer(userAnswer, correctAnswer, choices) {
            if (!userAnswer) return false;
            
            // ì„œìˆ í˜• ë‹µì¸ ê²½ìš° (choicesê°€ ì—†ê±°ë‚˜ 0ê°œì¸ ê²½ìš°)
            if (!choices || choices.length === 0) {
                // ë‹µì•ˆ ë°°ì—´ ì²˜ë¦¬
                if (correctAnswer.keys && correctAnswer.keys.length > 0) {
                    // ì²« ë²ˆì§¸ ë‹µì•ˆìœ¼ë¡œ ë¹„êµ
                    const correctText = normalizeAnswerText(correctAnswer.keys[0]);
                    const userText = normalizeAnswerText(userAnswer);
                    return checkAnswerMatch(userText, correctText);
                } else {
                    // raw_textë¡œ ë¹„êµ
                    const correctText = normalizeAnswerText(correctAnswer.raw_text);
                    const userText = normalizeAnswerText(userAnswer);
                    return checkAnswerMatch(userText, correctText);
                }
            }
            
            // ê°ê´€ì‹ ë‹µ ì²´í¬
            const user = mapAnswerKey(userAnswer, choices);
            const correct = correctAnswer.keys;
            
            // ë³µìˆ˜ ì •ë‹µ
            if (Array.isArray(user)) {
                return JSON.stringify(user.sort()) === JSON.stringify(correct.sort());
            }
            
            // ë‹¨ì¼ ì •ë‹µ
            return correct.includes(user);
        }
        
        // ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚°
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = levenshteinDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }
        
        // ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ ê³„ì‚°
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        // í•™ìŠµ ëª¨ë“œ ì„¤ì •
        function setMode(mode) {
            currentMode = mode;
            
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ë¬¸ì œ ë¡œë“œ
            loadQuestions(mode);
        }

        // ë¬¸ì œ ë¡œë“œ
        async function loadQuestions(mode) {
            try {
                // items.jsonl ë¡œë“œ
                const response = await fetch('items.jsonl');
                const text = await response.text();
                allQuestions = text.trim().split('\n').map(line => JSON.parse(line));
                
                // tables.jsonl ë¡œë“œ
                try {
                    const tablesResponse = await fetch('tables.jsonl');
                    const tablesText = await tablesResponse.text();
                    const tables = tablesText.trim().split('\n').map(line => JSON.parse(line));
                    
                    // í‘œë¥¼ IDë¡œ ì¸ë±ì‹±
                    allTables = {};
                    for (const table of tables) {
                        allTables[table.table_id] = table;
                    }
                    console.log(`${tables.length}ê°œ í‘œ ë¡œë“œ ì™„ë£Œ`);
                } catch (e) {
                    console.log('í‘œ ë°ì´í„° ì—†ìŒ:', e);
                }
                
                // ëª¨ë“œë³„ í•„í„°ë§
                currentQuestions = filterQuestionsByMode(mode);
                
                if (currentQuestions.length === 0) {
                    showMessage('í•´ë‹¹ ëª¨ë“œì— ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                currentIndex = 0;
                displayQuestion(currentQuestions[0]);
                updateStats();
                
            } catch (error) {
                console.error('ë¬¸ì œ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage('ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë“œë³„ í•„í„°ë§
        function filterQuestionsByMode(mode) {
            const savedProgress = JSON.parse(localStorage.getItem('progress') || '{}');
            const wrongQuestions = JSON.parse(localStorage.getItem('wrongQuestions') || '[]');
            const markedQuestions = JSON.parse(localStorage.getItem('markedQuestions') || '[]');
            
            switch(mode) {
                case 'sequential':
                    return allQuestions;
                    
                case 'random':
                    return shuffleArray([...allQuestions]);
                    
                case 'range':
                    // ëª¨ë‹¬ ì°½ í‘œì‹œ
                    showRangeModal();
                    return [];
                    
                case 'wrong':
                    return allQuestions.filter(q => wrongQuestions.includes(q.q_no));
                    
                case 'marked':
                    return allQuestions.filter(q => markedQuestions.includes(q.q_no));
                    
                default:
                    return allQuestions;
            }
        }

        // ë°°ì—´ ì„ê¸°
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ í‘œì‹œ
        function showRangeModal() {
            const modal = document.getElementById('rangeModal');
            modal.style.display = 'flex';
            
            // ì…ë ¥ê°’ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const startInput = document.getElementById('rangeStart');
            const endInput = document.getElementById('rangeEnd');
            
            startInput.addEventListener('input', updateRangePreview);
            endInput.addEventListener('input', updateRangePreview);
            
            updateRangePreview();
        }

        // ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeRangeModal() {
            const modal = document.getElementById('rangeModal');
            modal.style.display = 'none';
        }

        // ë²”ìœ„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updateRangePreview() {
            const start = parseInt(document.getElementById('rangeStart').value) || 1;
            const end = parseInt(document.getElementById('rangeEnd').value) || 130;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            const validStart = Math.max(1, Math.min(start, 130));
            const validEnd = Math.max(validStart, Math.min(end, 130));
            
            const count = validEnd - validStart + 1;
            const preview = document.getElementById('rangePreview');
            preview.textContent = `ì„ íƒëœ ë²”ìœ„: ${validStart}ë²ˆ ~ ${validEnd}ë²ˆ (ì´ ${count}ë¬¸ì œ)`;
        }

        // ë²”ìœ„ í•„í„° ì ìš©
        async function applyRangeFilter() {
            const start = parseInt(document.getElementById('rangeStart').value) || 1;
            const end = parseInt(document.getElementById('rangeEnd').value) || 130;
            const order = document.querySelector('input[name="rangeOrder"]:checked').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            const validStart = Math.max(1, Math.min(start, 130));
            const validEnd = Math.max(validStart, Math.min(end, 130));
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeRangeModal();
            
            // ë¬¸ì œ ë¡œë“œ
            try {
                // items.jsonl ë¡œë“œ
                const response = await fetch('items.jsonl');
                const text = await response.text();
                allQuestions = text.trim().split('\n').map(line => JSON.parse(line));
                
                // tables.jsonl ë¡œë“œ
                try {
                    const tablesResponse = await fetch('tables.jsonl');
                    const tablesText = await tablesResponse.text();
                    const tables = tablesText.trim().split('\n').map(line => JSON.parse(line));
                    
                    // í‘œë¥¼ IDë¡œ ì¸ë±ì‹±
                    allTables = {};
                    for (const table of tables) {
                        allTables[table.table_id] = table;
                    }
                    console.log(`${tables.length}ê°œ í‘œ ë¡œë“œ ì™„ë£Œ`);
                } catch (e) {
                    console.log('í‘œ ë°ì´í„° ì—†ìŒ:', e);
                }
                
                // ë²”ìœ„ í•„í„°ë§
                currentQuestions = allQuestions.filter(q => {
                    const num = parseInt(q.q_no.replace('Q', '').replace(/^0+/, '') || '0');
                    return num >= validStart && num <= validEnd;
                });
                
                // ìˆœì„œ ì ìš©
                if (order === 'random') {
                    currentQuestions = shuffleArray(currentQuestions);
                }
                
                if (currentQuestions.length === 0) {
                    showMessage('í•´ë‹¹ ë²”ìœ„ì— ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                currentIndex = 0;
                currentMode = 'range';
                displayQuestion(currentQuestions[currentIndex]);
                
                showMessage(`${validStart}~${validEnd}ë²ˆ ë¬¸ì œ ${currentQuestions.length}ê°œ ë¡œë“œ ì™„ë£Œ!`);
            } catch (error) {
                console.error('ë¬¸ì œ ë¡œë“œ ì‹¤íŒ¨:', error);
                showMessage('ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ë¬¸ì œ í‘œì‹œ
        function displayQuestion(question) {
            const container = document.getElementById('questionContainer');
            
            let html = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-no">${question.q_no}</div>
                        <button class="btn btn-secondary" onclick="markQuestion('${question.q_no}')">
                            <i class="fas fa-star"></i> ì²´í¬
                        </button>
                    </div>
                    <div class="question-text">${escapeHtml(question.question_text)}</div>
            `;
            
            // ì´ë¯¸ì§€ í‘œì‹œ
            if (question.image_refs && question.image_refs.length > 0) {
                for (let img of question.image_refs) {
                    html += `<img src="images/${img}" class="image-preview" alt="ë¬¸ì œ ì´ë¯¸ì§€">`;
                }
            }
            
            // í‘œ í‘œì‹œ
            if (question.table_refs && question.table_refs.length > 0) {
                for (let tableRef of question.table_refs) {
                    const table = allTables[tableRef];
                    if (table) {
                        html += '<div class="table-container">';
                        if (table.caption && table.caption.trim() !== '') {
                            html += `<div class="table-caption">${escapeHtml(table.caption)}</div>`;
                        }
                        html += '<table class="question-table">';
                        
                        // í—¤ë” (header ë˜ëŠ” headers í•„ë“œ ëª¨ë‘ ì§€ì›)
                        const headerData = table.headers || table.header;
                        if (headerData && headerData.length > 0) {
                            html += '<thead><tr>';
                            for (let cell of headerData) {
                                html += `<th>${escapeHtml(cell)}</th>`;
                            }
                            html += '</tr></thead>';
                        }
                        
                        // ë°”ë””
                        html += '<tbody>';
                        if (table.rows && table.rows.length > 0) {
                            for (let row of table.rows) {
                                html += '<tr>';
                                for (let cell of row) {
                                    // ì…€ ë‚´ìš©ì´ ì´ë¯¸ì§€ íŒŒì¼ëª…ì¸ì§€ í™•ì¸
                                    if (cell && typeof cell === 'string' && (cell.endsWith('.png') || cell.endsWith('.jpg') || cell.endsWith('.jpeg') || cell.endsWith('.gif'))) {
                                        html += `<td><img src="images/${cell}" class="table-image" alt=""></td>`;
                                    } else if (cell && typeof cell === 'string' && cell.includes('<strong>')) {
                                        // HTML íƒœê·¸ê°€ í¬í•¨ëœ ê²½ìš° ì´ìŠ¤ì¼€ì´í”„í•˜ì§€ ì•ŠìŒ
                                        html += `<td>${cell}</td>`;
                                    } else {
                                        // ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” ì´ìŠ¤ì¼€ì´í”„
                                        html += `<td>${escapeHtml(cell).replace(/\n/g, '<br>')}</td>`;
                                    }
                                }
                                html += '</tr>';
                            }
                        }
                        html += '</tbody></table></div>';
                        
                        // í‘œ ë’¤ì— ì¶”ê°€ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                        if (table.after_text) {
                            html += `<div class="table-after-text">${escapeHtml(table.after_text).replace(/\n/g, '<br>')}</div>`;
                        }
                    }
                }
            }
            
            // Q062 ë³´ê¸° (í…Œì´ë¸” ë’¤)
            if (question.q_no === 'Q062') {
                html += `
                    <div class="choices-section" style="margin-top: 20px;">
                        <strong>&lt;ë³´ê¸°&gt;</strong><br>
                        â€¢ Equivalence Partition<br>
                        â€¢ Boundary Value Analysis<br>
                        â€¢ Condition Test<br>
                        â€¢ Cause-Effect Graph<br>
                        â€¢ Error Guess<br>
                        â€¢ Comparison Test<br>
                        â€¢ Base Path Test<br>
                        â€¢ Loop Test<br>
                        â€¢ Data Flow Test
                    </div>
                `;
            }
            
            // ì„ íƒì§€ í‘œì‹œ
            if (question.choices && question.choices.length > 0) {
                html += '<div class="choices">';
                for (let choice of question.choices) {
                    html += `
                        <div class="choice-item" onclick="selectChoice(this)">
                            <span class="choice-key">${choice.raw_key}</span>
                            <span class="choice-text">${escapeHtml(choice.text)}</span>
                        </div>
                    `;
                }
                html += '</div>';
            }
            
            // ë³µìˆ˜ ë‹µì•ˆ ê°œìˆ˜ í™•ì¸
            let numAnswers = 1;
            
            // 1. ê´„í˜¸ ì•ˆ ë²ˆí˜¸ ë²”ìœ„ ì¶”ì¶œ: (â‘ ~â‘¤)
            const rangeMatch = question.question_text.match(/\([\s]*([â‘ -â‘³])[\s]*~[\s]*([â‘ -â‘³])[\s]*\)/);
            if (rangeMatch) {
                const startNum = rangeMatch[1].charCodeAt(0) - 0x2460 + 1;
                const endNum = rangeMatch[2].charCodeAt(0) - 0x2460 + 1;
                numAnswers = endNum - startNum + 1;
            }
            
            // 2. ê´„í˜¸ ì•ˆ ë²ˆí˜¸ ê°œìˆ˜ ì¶”ì¶œ: (â‘ , â‘¡) ë˜ëŠ” (â‘  â‘¡ â‘¢)
            if (numAnswers === 1) {
                const bracketNumbers = question.question_text.match(/\([\s]*([â‘ -â‘³][\s,]*[\sâ‘ -â‘³]*)+\s*\)/);
                if (bracketNumbers) {
                    const matches = bracketNumbers[0].match(/[â‘ -â‘³]/g);
                    if (matches && matches.length > 1) {
                        numAnswers = matches.length;
                    }
                }
            }
            
            // 3. ì •ë‹µ ë°°ì—´ ê¸¸ì´ë¡œ í™•ì¸
            if (numAnswers === 1 && question.answer && question.answer.keys && question.answer.keys.length > 1) {
                numAnswers = question.answer.keys.length;
            }
            
            // 16ë²ˆ, 17ë²ˆì€ íŠ¹ìˆ˜: ìˆœì°¨ ì…ë ¥ ëª¨ë“œ (1ê°œ ì…ë ¥ì°½)
            if (question.q_no === 'Q016' || question.q_no === 'Q017') {
                numAnswers = 1;
            }
            
            // ì…ë ¥ í•„ë“œ ìƒì„±
            if (numAnswers > 1) {
                // ë³µìˆ˜ ë‹µì•ˆ ì…ë ¥ì°½
                html += `<div class="multiple-answers">`;
                
                // íŠ¹ì • ë¬¸ì œëŠ” ì»¤ìŠ¤í…€ ë¼ë²¨
                const customLabels = {
                    'Q013': ['ì¹´ë””ë„ë¦¬í‹°:', 'ë””ê·¸ë¦¬:'],
                    'Q008': ['ê³„ì‚°ì‹:', 'ë‹µ:'],
                    'Q122': ['LEVEL:']
                };
                
                for (let i = 0; i < numAnswers; i++) {
                    let label;
                    
                    if (customLabels[question.q_no] && customLabels[question.q_no][i]) {
                        label = customLabels[question.q_no][i];
                    } else {
                        const num = String.fromCharCode(0x2460 + i); // â‘ , â‘¡, ...
                        label = `${num}:`;
                    }
                    
                    html += `
                        <div class="answer-item">
                            <label>${label}</label>
                            <input type="text" class="answer-input-small" id="answerInput_${i}" 
                                   placeholder="ë‹µ ì…ë ¥">
                        </div>
                    `;
                }
                html += `</div>`;
                
                // íŠ¹ìˆ˜ë¬¸ìê°€ í•„ìš”í•œì§€ í™•ì¸ (ì •ë‹µì— íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ë˜ì–´ ìˆëŠ” ê²½ìš°ë§Œ)
                const hasSymbols = question.answer && question.answer.keys && 
                    question.answer.keys.some(ans => /[âˆªâ€•Ã—Ï€â–·â—âˆ©Ã·Î”]/.test(ans));
                
                if (hasSymbols) {
                    html += `
                        <div class="symbol-buttons">
                            <strong>ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°í˜¸:</strong>
                            <button class="symbol-btn" onclick="insertSymbol('âˆª')">âˆª</button>
                            <button class="symbol-btn" onclick="insertSymbol('â€•')">â€•</button>
                            <button class="symbol-btn" onclick="insertSymbol('Ã—')">Ã—</button>
                            <button class="symbol-btn" onclick="insertSymbol('Ï€')">Ï€</button>
                            <button class="symbol-btn" onclick="insertSymbol('â–·â—')">â–·â—</button>
                            <button class="symbol-btn" onclick="insertSymbol('âˆ©')">âˆ©</button>
                            <button class="symbol-btn" onclick="insertSymbol('Ã·')">Ã·</button>
                            <button class="symbol-btn" onclick="insertSymbol('Î”')">Î”</button>
                        </div>
                    `;
                }
            } else {
                // ë‹¨ì¼ ë‹µì•ˆ ì…ë ¥ì°½
                const placeholder = (question.q_no === 'Q016' || question.q_no === 'Q017') ? 'íŠ¹ìˆ˜ë¬¸ì ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”' : 'ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1, 2, a, b, ã„±, â‘ )';
                const isReadonly = question.q_no === 'Q016' || question.q_no === 'Q017';
                html += `
                    <input type="text" class="answer-input" id="answerInput_0" 
                           placeholder="${placeholder}" ${isReadonly ? 'readonly' : ''}>
                `;
            }
            
            // 16ë²ˆ, 17ë²ˆì€ íŠ¹ìˆ˜ë¬¸ì ë²„íŠ¼ í‘œì‹œ
            if (question.q_no === 'Q016' || question.q_no === 'Q017') {
                html += `
                    <div class="symbol-buttons">
                        <strong>ê¸°í˜¸ë¥¼ ìˆœì„œëŒ€ë¡œ í´ë¦­í•˜ì„¸ìš” (ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì œê±°):</strong>
                        <button class="symbol-btn" onclick="insertSymbol('âˆª')">âˆª</button>
                        <button class="symbol-btn" onclick="insertSymbol('â€•')">â€•</button>
                        <button class="symbol-btn" onclick="insertSymbol('Ã—')">Ã—</button>
                        <button class="symbol-btn" onclick="insertSymbol('Ï€')">Ï€</button>
                        <button class="symbol-btn" onclick="insertSymbol('â–·â—')">â–·â—</button>
                        <button class="symbol-btn" onclick="insertSymbol('âˆ©')">âˆ©</button>
                        <button class="symbol-btn" onclick="insertSymbol('Ã·')">Ã·</button>
                        <button class="symbol-btn" onclick="insertSymbol('Î”')">Î”</button>
                    </div>
                `;
            }
            
            html += `
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="checkCurrentAnswer()">
                            <i class="fas fa-check"></i> ì •ë‹µ í™•ì¸
                        </button>
                        <button class="btn" onclick="showAnswerOnly()" style="background: #17a2b8; color: white;">
                            <i class="fas fa-eye"></i> ë‹µ ë³´ê¸°
                        </button>
                        <button class="btn btn-secondary" onclick="prevQuestion()">
                            <i class="fas fa-arrow-left"></i> ì´ì „ ë¬¸ì œ
                        </button>
                        <button class="btn btn-secondary" onclick="nextQuestion()">
                            <i class="fas fa-arrow-right"></i> ë‹¤ìŒ ë¬¸ì œ
                        </button>
                        <button class="btn btn-secondary" onclick="showExplanation()">
                            <i class="fas fa-lightbulb"></i> í•´ì„¤ ë³´ê¸°
                        </button>
                    </div>
                    <div class="result-section" id="resultSection" style="display: none;"></div>
                    <div class="explanation" id="explanationDiv"></div>
            </div>
            `;
            
            container.innerHTML = html;
        }

        // ì´ë¯¸ ë‹µë³€í•œ ë¬¸ì œ ì¶”ì 
        let answeredQuestions = new Set();

        // ì •ë‹µ í™•ì¸
        function checkCurrentAnswer() {
            const question = currentQuestions[currentIndex];
            const questionId = question.q_no;
            
            // ì´ë¯¸ ë‹µë³€í–ˆìœ¼ë©´ ë¬´ì‹œ
            if (answeredQuestions.has(questionId)) {
                console.log('ì´ë¯¸ ë‹µë³€í•œ ë¬¸ì œì…ë‹ˆë‹¤.');
                return;
            }
            
            // ë³µìˆ˜ ë‹µì•ˆì¸ì§€ í™•ì¸
            let userAnswers = [];
            const answerInput0 = document.getElementById('answerInput_0');
            
            if (answerInput0) {
                // ëª¨ë“  ì…ë ¥ì°½ í™•ì¸ (0ë¶€í„° ì‹œì‘)
                for (let i = 0; i < 10; i++) {
                    const input = document.getElementById(`answerInput_${i}`);
                    if (input) {
                        userAnswers.push(input.value);
                    }
                }
            }
            
            // ë‹µë³€ ì…ë ¥ í™•ì¸
            if (userAnswers.length === 0 || userAnswers.every(a => !a || !a.trim())) {
                alert('ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const isCorrect = checkMultipleAnswer(userAnswers, question);
            const resultSection = document.getElementById('resultSection');
            
            // ì´ë¯¸ ë‹µë³€í–ˆë‹¤ê³  í‘œì‹œ
            answeredQuestions.add(questionId);
            
            // ê²°ê³¼ ì˜ì—­ í‘œì‹œ
            resultSection.style.display = 'block';
            
            if (isCorrect) {
                resultSection.className = 'result-section result-correct show';
                resultSection.innerHTML = '<i class="fas fa-check-circle"></i> <strong>ì •ë‹µì…ë‹ˆë‹¤!</strong>';
                stats.correct++;
                removeWrongQuestion(question.q_no);
            } else {
                resultSection.className = 'result-section result-incorrect show';
                
                // ì •ë‹µ í…ìŠ¤íŠ¸ ì²˜ë¦¬ (ê´„í˜¸ ì œê±°)
                let answerText = question.answer.raw_text || 'ì •ë‹µ ì—†ìŒ';
                
                // ê´„í˜¸ ì•ˆ ë‚´ìš© ì œê±°
                answerText = answerText.replace(/\([^)]*\)/g, '');
                // â€¢ ì œê±°
                answerText = answerText.replace(/[â€¢]/g, '');
                // ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ
                answerText = answerText.replace(/\s+/g, ' ').trim();
                
                resultSection.innerHTML = `
                    <i class="fas fa-times-circle"></i> <strong>ì˜¤ë‹µì…ë‹ˆë‹¤.</strong><br>
                    <strong>ì •ë‹µ:</strong> ${escapeHtml(answerText)}
                `;
                stats.wrong++;
                addWrongQuestion(question.q_no);
            }
            
            // LocalStorageì— ì €ì¥
            saveProgress();
            updateStats();
        }
        
        // ë³µìˆ˜ ë‹µì•ˆ ì²´í¬ (ìŠ¤ë§ˆíŠ¸ ë§¤ì¹­)
        function checkMultipleAnswer(userAnswers, question) {
            const correctAnswers = question.answer.keys || [];
            
            console.log('=== ë³µìˆ˜ ë‹µì•ˆ ì²´í¬ ===');
            console.log('ë¬¸ì œ:', question.q_no);
            console.log('ì…ë ¥:', userAnswers);
            console.log('ì •ë‹µ:', correctAnswers);
            
            if (userAnswers.length !== correctAnswers.length) {
                console.log('âŒ ë‹µì•ˆ ê°œìˆ˜ ë¶ˆì¼ì¹˜');
                return false;
            }
            
            // Q060 íŠ¹ë³„ ì²˜ë¦¬: ìˆ«ìë§Œ ë¹„êµ
            if (question.q_no === 'Q060') {
                console.log('ğŸ”¢ Q060 ìˆ«ì ì „ìš© ë§¤ì¹­');
                for (let i = 0; i < userAnswers.length; i++) {
                    const userDigits = (userAnswers[i] || '').toString().replace(/[^0-9]/g, '');
                    const correctDigits = (correctAnswers[i] || '').toString().replace(/[^0-9]/g, '');
                    console.log(`  [${i+1}] "${userDigits}" === "${correctDigits}" ?`, userDigits === correctDigits);
                    if (userDigits !== correctDigits) {
                        console.log('âŒ ë¶ˆì¼ì¹˜');
                        return false;
                    }
                }
                console.log('âœ… Q060 ì •ë‹µ!');
                return true;
            }
            
            // ê° ë‹µì•ˆ ë¹„êµ (ìˆœì„œ ì¤‘ìš”)
            for (let i = 0; i < userAnswers.length; i++) {
                const user = normalizeAnswerText(userAnswers[i]);
                const correct = normalizeAnswerText(correctAnswers[i]);
                
                console.log(`ë‹µì•ˆ ${i+1}:`);
                console.log('  ì…ë ¥:', user);
                console.log('  ì •ë‹µ:', correct);
                
                // í‚¤ì›Œë“œ ê¸°ë°˜ ë§¤ì¹­
                const match = checkAnswerMatch(user, correct);
                console.log('  ê²°ê³¼:', match ? 'âœ…' : 'âŒ');
                
                if (!match) {
                    return false;
                }
            }
            
            console.log('âœ… ì •ë‹µ!');
            return true;
        }
        
        // ë‹µì•ˆ í…ìŠ¤íŠ¸ ì •ê·œí™”
        function normalizeAnswerText(text) {
            if (!text) return '';
            
            // ì†Œë¬¸ìë¡œ ë³€í™˜
            text = text.toLowerCase();
            
            // ì›ë¬¸ìë¥¼ í•œê¸€ ììŒìœ¼ë¡œ ë³€í™˜ (ã‰ â†’ã„±, ã‰¡â†’ã„´, ã‰¢â†’ã„·, ã‰£â†’ã„¹, ã‰¤â†’ã…, ã‰¥â†’ã…‚, ã‰¦â†’ã……, ã‰§â†’ã…‡, ã‰¨â†’ã…ˆ)
            const circledToJamo = {
                'ã‰ ': 'ã„±', 'ã‰¡': 'ã„´', 'ã‰¢': 'ã„·', 'ã‰£': 'ã„¹', 'ã‰¤': 'ã…',
                'ã‰¥': 'ã…‚', 'ã‰¦': 'ã……', 'ã‰§': 'ã…‡', 'ã‰¨': 'ã…ˆ', 'ã‰©': 'ã…Š'
            };
            text = text.replace(/[ã‰ -ã‰©]/g, match => circledToJamo[match] || match);
            
            // ê´„í˜¸ ì•ˆ ë‚´ìš© ì œê±°: ê´€ê³„(Relationship) -> ê´€ê³„
            text = text.replace(/\([^)]*\)/g, '');
            
            // ë„ì–´ì“°ê¸° ì œê±°
            text = text.replace(/\s+/g, '');
            
            // ê¸°íƒ€ íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬ (ì‰¼í‘œ, í™”ì‚´í‘œ, í•˜ì´í”ˆ, ì  ë“±)
            text = text.replace(/[â€¢Â·,â†’\-\.]/g, '');
            
            return text.trim();
        }
        
        // ë‹µì•ˆ ë§¤ì¹­ ì²´í¬ (ìŠ¤ë§ˆíŠ¸ ë§¤ì¹­)
        function checkAnswerMatch(user, correct) {
            // ì •í™• ì¼ì¹˜
            if (user === correct) {
                return true;
            }
            
            // ìˆ«ìë§Œ ìˆëŠ” ê²½ìš° (60ë²ˆ ë¬¸ì œ ë“±)
            const userDigits = user.replace(/[^0-9]/g, '');
            const correctDigits = correct.replace(/[^0-9]/g, '');
            
            if (userDigits && correctDigits && userDigits === correctDigits) {
                return true;
            }
            
            // í‚¤ì›Œë“œ ì¶”ì¶œ (í•œê¸€/ì˜ë¬¸ ë‹¨ì–´)
            const getKeywords = (text) => {
                return text.match(/[ê°€-í£]+|[a-z]+/gi) || [];
            };
            
            const userKeywords = getKeywords(user);
            const correctKeywords = getKeywords(correct);
            
            // í•˜ë‚˜ë¼ë„ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ë‹¨ìˆœ ë¹„êµ
            if (userKeywords.length === 0 || correctKeywords.length === 0) {
                return user === correct;
            }
            
            // í‚¤ì›Œë“œ ë§¤ì¹­ ìˆ˜
            let matches = 0;
            for (const keyword of userKeywords) {
                if (correctKeywords.some(ck => ck.includes(keyword) || keyword.includes(ck))) {
                    matches++;
                }
            }
            
            // 50% ì´ìƒ ë§¤ì¹­
            const matchRate = matches / Math.max(userKeywords.length, correctKeywords.length);
            return matchRate >= 0.5;
        }
        
        // íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ í•¨ìˆ˜
        // íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ ìˆœì„œ ì¶”ì 
        let symbolInputOrder = {
            symbols: [],
            inputIndex: 0
        };

        function insertSymbol(symbol) {
            const question = currentQuestions[currentIndex];
            
            // 16ë²ˆ, 17ë²ˆ: ìˆœì°¨ ì…ë ¥ ëª¨ë“œ
            if (question.q_no === 'Q016' || question.q_no === 'Q017') {
                const input = document.getElementById('answerInput_0');
                if (!input) return;
                
                // ê°™ì€ ê¸°í˜¸ë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì œê±°
                const currentSymbols = symbolInputOrder.symbols;
                const symbolIndex = currentSymbols.indexOf(symbol);
                
                if (symbolIndex > -1) {
                    // ì´ë¯¸ ìˆëŠ” ê¸°í˜¸ì´ë©´ ì œê±°
                    currentSymbols.splice(symbolIndex, 1);
                    symbolInputOrder.inputIndex = currentSymbols.length;
                } else {
                    // ìƒˆë¡œìš´ ê¸°í˜¸ ì¶”ê°€ (16ë²ˆì€ ìµœëŒ€ 5ê°œ, 17ë²ˆì€ 1ê°œ)
                    const maxSymbols = question.q_no === 'Q016' ? 5 : 1;
                    
                    // 17ë²ˆì€ 1ê°œë§Œ ì…ë ¥ ê°€ëŠ¥ (ì´ë¯¸ ì…ë ¥ëœ ê¸°í˜¸ê°€ ìˆìœ¼ë©´ êµì²´)
                    if (question.q_no === 'Q017' && currentSymbols.length > 0) {
                        currentSymbols[0] = symbol;
                        symbolInputOrder.inputIndex = 1;
                    } else if (currentSymbols.length < maxSymbols) {
                        currentSymbols.push(symbol);
                        symbolInputOrder.inputIndex = currentSymbols.length;
                    }
                }
                
                // ì…ë ¥ì°½ì— í‘œì‹œ
                input.value = currentSymbols.join(', ');
                return;
            }
            
            // ë‹¤ë¥¸ ë¬¸ì œ: ì¼ë°˜ ì…ë ¥
            const answerInputs = [];
            for (let i = 0; i < 10; i++) {
                const input = document.getElementById(`answerInput_${i}`);
                if (input) {
                    answerInputs.push(input);
                }
            }
            
            if (answerInputs.length === 0) return;
            
            const activeElement = document.activeElement;
            if (activeElement && activeElement.classList.contains('answer-input-small')) {
                const selectionStart = activeElement.selectionStart;
                const selectionEnd = activeElement.selectionEnd;
                const value = activeElement.value;
                
                activeElement.value = value.substring(0, selectionStart) + symbol + value.substring(selectionEnd);
                activeElement.focus();
                activeElement.setSelectionRange(selectionStart + symbol.length, selectionStart + symbol.length);
            }
        }

        // ì´ì „ ë¬¸ì œ
        function prevQuestion() {
            currentIndex--;
            if (currentIndex < 0) {
                currentIndex = currentQuestions.length - 1;
                showMessage('ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤. ë§ˆì§€ë§‰ ë¬¸ì œë¡œ ì´ë™í•©ë‹ˆë‹¤.');
            }
            displayQuestion(currentQuestions[currentIndex]);
            
            // ìƒˆ ë¬¸ì œì´ë¯€ë¡œ answeredQuestionsì—ì„œ ì œê±°
            const questionId = currentQuestions[currentIndex].q_no;
            answeredQuestions.delete(questionId);
            
            // íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ ìˆœì„œ ì´ˆê¸°í™”
            symbolInputOrder = {
                symbols: [],
                inputIndex: 0
            };
        }
        
        // ë‹¤ìŒ ë¬¸ì œ
        function nextQuestion() {
            currentIndex++;
            if (currentIndex >= currentQuestions.length) {
                currentIndex = 0;
                showMessage('ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!');
            }
            displayQuestion(currentQuestions[currentIndex]);
            
            // ìƒˆ ë¬¸ì œì´ë¯€ë¡œ answeredQuestionsì—ì„œ ì œê±°
            const questionId = currentQuestions[currentIndex].q_no;
            answeredQuestions.delete(questionId);
            
            // íŠ¹ìˆ˜ë¬¸ì ì…ë ¥ ìˆœì„œ ì´ˆê¸°í™”
            symbolInputOrder = {
                symbols: [],
                inputIndex: 0
            };
        }

        // í•´ì„¤ ë³´ê¸°
        function showExplanation() {
            const explanationDiv = document.getElementById('explanationDiv');
            const question = currentQuestions[currentIndex];
            
            if (question.explanation) {
                explanationDiv.textContent = question.explanation;
                explanationDiv.classList.toggle('show');
            } else {
                explanationDiv.textContent = 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.';
                explanationDiv.classList.add('show');
            }
        }

        // ë‹µ ë³´ê¸° (í•™ìŠµ ëª¨ë“œ - í†µê³„ ë°˜ì˜ ì•ˆ í•¨)
        function showAnswerOnly() {
            const question = currentQuestions[currentIndex];
            const resultSection = document.getElementById('resultSection');
            
            // ì •ë‹µ í…ìŠ¤íŠ¸ ì²˜ë¦¬ (ê´„í˜¸ ì œê±°)
            let answerText = question.answer.raw_text || 'ì •ë‹µ ì—†ìŒ';
            
            // ê´„í˜¸ ì•ˆ ë‚´ìš© ì œê±°
            answerText = answerText.replace(/\([^)]*\)/g, '');
            // â€¢ ì œê±°
            answerText = answerText.replace(/[â€¢]/g, '');
            // ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ
            answerText = answerText.replace(/\s+/g, ' ').trim();
            
            // ê²°ê³¼ ì˜ì—­ í‘œì‹œ (ì •ë³´ì„± ìŠ¤íƒ€ì¼)
            resultSection.style.display = 'block';
            resultSection.className = 'result-section';
            resultSection.style.background = '#d1ecf1';
            resultSection.style.border = '2px solid #0c5460';
            resultSection.style.color = '#0c5460';
            resultSection.innerHTML = `
                <i class="fas fa-eye"></i> <strong>ì •ë‹µ:</strong> ${escapeHtml(answerText)}
            `;
        }

        // ì„ íƒì§€ ì„ íƒ
        function selectChoice(element) {
            document.querySelectorAll('.choice-item').forEach(item => {
                item.style.background = '#f8f9fa';
            });
            element.style.background = '#667eea';
            element.style.color = 'white';
            
            const answerInput = document.getElementById('answerInput');
            const key = element.querySelector('.choice-key').textContent.trim();
            answerInput.value = key;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            stats.total = allQuestions.length;
            const progress = ((stats.correct + stats.wrong) / stats.total * 100).toFixed(1);
            const accuracy = stats.correct > 0 ? (stats.correct / (stats.correct + stats.wrong) * 100).toFixed(1) : 0;
            
            document.getElementById('progress').textContent = progress + '%';
            document.getElementById('accuracy').textContent = accuracy + '%';
            document.getElementById('remaining').textContent = allQuestions.length - (stats.correct + stats.wrong);
            document.getElementById('wrongCount').textContent = stats.wrong;
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(msg) {
            alert(msg);
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ì§„í–‰ ìƒí™© ì €ì¥
        function saveProgress() {
            localStorage.setItem('progress', JSON.stringify({
                correct: stats.correct,
                wrong: stats.wrong
            }));
        }

        // ì§„í–‰ ìƒí™© ë¡œë“œ
        function loadProgress() {
            const saved = JSON.parse(localStorage.getItem('progress') || '{}');
            stats.correct = saved.correct || 0;
            stats.wrong = saved.wrong || 0;
        }

        // ì˜¤ë‹µ ì¶”ê°€
        function addWrongQuestion(qNo) {
            const wrongQuestions = JSON.parse(localStorage.getItem('wrongQuestions') || '[]');
            if (!wrongQuestions.includes(qNo)) {
                wrongQuestions.push(qNo);
                localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
            }
        }

        // ì˜¤ë‹µ ì œê±°
        function removeWrongQuestion(qNo) {
            const wrongQuestions = JSON.parse(localStorage.getItem('wrongQuestions') || '[]');
            const index = wrongQuestions.indexOf(qNo);
            if (index > -1) {
                wrongQuestions.splice(index, 1);
                localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
            }
        }

        // ë¬¸ì œ ì²´í¬
        function markQuestion(qNo) {
            const markedQuestions = JSON.parse(localStorage.getItem('markedQuestions') || '[]');
            const btn = event.target.closest('button');
            
            if (!markedQuestions.includes(qNo)) {
                markedQuestions.push(qNo);
                localStorage.setItem('markedQuestions', JSON.stringify(markedQuestions));
                btn.innerHTML = '<i class="fas fa-check"></i> ì²´í¬ë¨';
                btn.style.background = '#28a745';
            } else {
                const index = markedQuestions.indexOf(qNo);
                markedQuestions.splice(index, 1);
                localStorage.setItem('markedQuestions', JSON.stringify(markedQuestions));
                btn.innerHTML = '<i class="fas fa-star"></i> ì²´í¬';
                btn.style.background = '';
            }
        }

        // ì§„í–‰ ì´ˆê¸°í™”
        function resetProgress() {
            if (confirm('ëª¨ë“  ì§„í–‰ ìƒí™©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.clear();
                stats = { total: 0, correct: 0, wrong: 0, wrongQuestions: [] };
                updateStats();
                location.reload();
            }
        }

        // í™˜ì˜ íŒì—… ë‹«ê¸°
        function closeWelcomePopup() {
            document.getElementById('welcomePopup').classList.remove('show');
            localStorage.setItem('welcomeShown', 'true');
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            updateStats();
            
            // í™˜ì˜ íŒì—… í‘œì‹œ (ì²« ë°©ë¬¸ ì‹œ)
            if (!localStorage.getItem('welcomeShown')) {
                document.getElementById('welcomePopup').classList.add('show');
            }
        });
    </script>
</body>
</html>

